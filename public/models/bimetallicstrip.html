<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›™é‡‘å±¬ç‰‡è™›æ“¬å¯¦é©—</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --bg-color: #0f172a;
            --panel-bg: #1e293b;
            --text-color: #f1f5f9;
            --accent-color: #38bdf8;
            --success-color: #4ade80;
            --warning-color: #facc15;
            --danger-color: #ef4444;
            --nav-bg: #334155;
            --formula-bg: #0f172a;
        }

        body {
            /* è¨­å®šå­—é«”å„ªå…ˆé †åºï¼Œç¢ºä¿ä¸­æ–‡é¡¯ç¤ºæ­£å¸¸ */
            font-family: 'Microsoft JhengHei', 'å¾®è»Ÿæ­£é»‘é«”', 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        /* é ‚éƒ¨æ¨™é¡Œåˆ— */
        .main-nav {
            background: var(--nav-bg);
            padding: 0 20px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
            z-index: 10;
            flex-shrink: 0; /* é˜²æ­¢è¢«å£“ç¸® */
        }

        .brand {
            font-size: 1.2rem;
            font-weight: bold;
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* ä¸»ä½ˆå±€ - ä¿®æ­£ç‰ˆé¢èˆ‡å¤–æ¡†å°é½Š */
        .main-layout {
            display: grid;
            grid-template-columns: 360px 1fr;
            flex: 1;
            overflow: hidden;
            padding: 20px; /* å¤–åœçµ±ä¸€é–“è· */
            gap: 20px;     /* å·¦å³å€å¡Šé–“è· */
            box-sizing: border-box;
        }

        /* å·¦å´æ§åˆ¶é¢æ¿ - æ”¹ç‚ºå¡ç‰‡å¼ */
        .sidebar {
            background: var(--panel-bg);
            border: 1px solid #334155; /* æ”¹ç‚ºå››å‘¨é‚Šæ¡† */
            border-radius: 12px;       /* åœ“è§’èˆ‡å³å´ä¸€è‡´ */
            padding: 20px;
            overflow-y: auto;          /* å…§éƒ¨æ²è»¸ */
            display: flex;
            flex-direction: column;
            gap: 15px;
            height: 100%;              /* å¡«æ»¿ Grid é«˜åº¦ */
            box-sizing: border-box;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }

        /* æŒ‘æˆ°ç‹€æ…‹å¡ */
        .challenge-status-card {
            background: rgba(56, 189, 248, 0.15);
            border: 2px solid var(--accent-color);
            border-radius: 8px;
            padding: 15px;
            display: none; /* é è¨­éš±è— */
            animation: fadeIn 0.5s;
        }
        .cs-title { color: var(--accent-color); font-weight: bold; margin-bottom: 5px; font-size: 1rem; display: flex; align-items: center; gap: 5px; }
        .cs-target { font-size: 0.9rem; color: white; margin-bottom: 10px; line-height: 1.4; }
        .cs-btn-quit {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #ccc;
            padding: 6px 10px;
            font-size: 0.85rem;
            cursor: pointer;
            border-radius: 4px;
            width: 100%;
            transition: all 0.2s;
        }
        .cs-btn-quit:hover { background: rgba(255, 255, 255, 0.2); color: white; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        /* é€šç”¨æ§åˆ¶é … */
        .section-title {
            font-size: 0.9rem;
            color: #94a3b8;
            border-bottom: 1px solid #334155;
            padding-bottom: 5px;
            font-weight: bold;
            margin-top: 5px;
        }

        .control-group {
            margin-bottom: 10px;
        }

        label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9rem;
            color: #cbd5e1;
        }

        select, input[type="range"] {
            width: 100%;
            background: #0f172a;
            color: white;
            border: 1px solid #475569;
            padding: 8px;
            border-radius: 6px;
            outline: none;
            font-family: inherit;
        }

        .val-disp { font-family: monospace; color: var(--accent-color); }

        .btn {
            background: var(--accent-color);
            color: #0f172a;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: transform 0.1s;
            font-family: inherit;
        }
        .btn:hover { opacity: 0.9; transform: scale(1.02); }
        .btn-reset { background: #475569; margin-top: 10px; color: white; }
        
        .btn-scenario {
            background: transparent;
            border: 1px solid var(--accent-color);
            color: var(--accent-color);
            margin-bottom: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
        }
        .btn-scenario:hover {
            background: rgba(56, 189, 248, 0.1);
        }

        /* å³å´ç•«å¸ƒèˆ‡æ•¸æ“š */
        .workspace {
            display: flex;
            flex-direction: column;
            gap: 20px;
            /* ç§»é™¤å…§è·èˆ‡èƒŒæ™¯ï¼Œæ”¹ç”±å¤–å±¤æ§åˆ¶ */
            height: 100%;
            box-sizing: border-box;
            overflow: hidden; 
        }

        .canvas-container {
            flex: 2;
            background: #fff;
            border-radius: 12px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            min-height: 250px;
        }
        
        canvas { width: 100%; height: 100%; cursor: crosshair; }

        .data-panel {
            flex: 1;
            background: var(--panel-bg);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid #334155;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            min-height: 150px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .formula-box {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .math-row { margin-bottom: 5px; color: #94a3b8; font-size: 0.85rem; }
        .math-val { color: var(--accent-color); font-weight: bold; }
        .math-res { color: var(--warning-color); font-weight: bold; font-size: 1.1em; }

        /* ç‰¹æ•ˆå…ƒä»¶ */
        .alarm-status {
            position: absolute; top: 20px; right: 20px;
            display: flex; flex-direction: column; align-items: center; gap: 5px;
        }
        .alarm-light {
            width: 30px; height: 30px; border-radius: 50%; 
            background: #333; border: 2px solid #555;
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
            transition: all 0.2s;
        }
        .alarm-on {
            background: #ef4444;
            box-shadow: 0 0 20px #ef4444;
            animation: pulse 0.5s infinite alternate;
        }
        .alarm-label {
            font-size: 0.75rem; color: #555; font-weight: bold;
            background: rgba(255,255,255,0.8); padding: 2px 6px; border-radius: 4px;
        }
        @keyframes pulse { to { transform: scale(1.1); opacity: 1; } from { opacity: 0.8; } }

        /* çµæœé€šçŸ¥ Toast */
        .result-toast {
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
            padding: 15px 30px; border-radius: 50px; color: white; font-weight: bold;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5); z-index: 20;
            display: none; animation: slideUp 0.3s; text-align: center;
            min-width: 300px;
        }
        .toast-success { background: linear-gradient(135deg, #10b981, #059669); border: 2px solid #6ee7b7; }
        .toast-fail { background: linear-gradient(135deg, #ef4444, #b91c1c); border: 2px solid #fca5a5; }
        
        @keyframes slideUp { from { bottom: -50px; opacity: 0; } to { bottom: 30px; opacity: 1; } }

        /* Modal Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(4px);
        }

        .modal-content {
            background: #1e293b;
            width: 90%;
            max-width: 650px;
            max-height: 85vh;
            border-radius: 12px;
            border: 1px solid #475569;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            overflow-y: auto;
            position: relative;
            padding: 0;
        }

        .modal-header {
            background: #0f172a;
            padding: 20px;
            border-bottom: 1px solid #334155;
            position: sticky;
            top: 0;
            z-index: 10;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 { margin: 0; color: white; font-size: 1.2rem; display: flex; align-items: center; gap: 10px; }
        .close-btn { background: none; border: none; color: #94a3b8; font-size: 1.5rem; cursor: pointer; transition: color 0.2s; }
        .close-btn:hover { color: #ef4444; }

        .modal-body { padding: 20px; }

        .scenario-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            border-left: 4px solid var(--accent-color);
            position: relative;
        }

        .s-tag { 
            display: inline-block; 
            padding: 2px 8px; 
            border-radius: 4px; 
            font-size: 0.75rem; 
            font-weight: bold;
            margin-bottom: 8px;
            background: rgba(56, 189, 248, 0.2); 
            color: var(--accent-color);
        }

        .s-title { font-size: 1.1rem; color: #f1f5f9; font-weight: bold; margin-bottom: 8px; }
        .s-desc { font-size: 0.95rem; color: #cbd5e1; line-height: 1.6; margin-bottom: 10px; }
        .s-hint { 
            background: rgba(250, 204, 21, 0.1); 
            color: #facc15; 
            padding: 8px 12px; 
            border-radius: 6px; 
            font-size: 0.9rem;
            display: flex;
            gap: 8px;
            align-items: flex-start;
        }
        
        .btn-start-challenge {
            background: var(--accent-color); color: #0f172a; border: none;
            padding: 8px 15px; border-radius: 6px; cursor: pointer; font-weight: bold;
            margin-top: 10px; float: right;
        }
        .btn-start-challenge:hover { opacity: 0.9; transform: scale(1.05); }

        /* ç‰©ç†å‡è¨­å€å¡Šæ¨£å¼ */
        .assumptions-box {
            margin-top: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            border: 1px dashed #475569;
            font-size: 0.9rem;
            color: #94a3b8;
        }
        .assumptions-box h3 {
            margin-top: 0;
            color: #cbd5e1;
            font-size: 1rem;
            border-bottom: 1px solid #475569;
            padding-bottom: 8px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .assumptions-box ul {
            padding-left: 20px;
            margin: 0;
        }
        .assumptions-box li {
            margin-bottom: 10px;
            line-height: 1.5;
        }
        .assumptions-box strong {
            color: #a5b4fc;
        }

    </style>
</head>
<body>

    <!-- é ‚éƒ¨æ¨™é¡Œ -->
    <nav class="main-nav">
        <div class="brand">
            <i class="fas fa-fire-alt"></i> é›™é‡‘å±¬ç‰‡è™›æ“¬å¯¦é©—
        </div>
    </nav>

    <div class="main-layout">
        <!-- å·¦å´é¢æ¿ -->
        <aside class="sidebar">
            
            <!-- æŒ‘æˆ°ç‹€æ…‹å¡ (é€²è¡ŒæŒ‘æˆ°æ™‚é¡¯ç¤º) -->
            <div id="challengeStatus" class="challenge-status-card">
                <div class="cs-title"><i class="fas fa-flag-checkered"></i> æŒ‘æˆ°é€²è¡Œä¸­</div>
                <div id="csTargetText" class="cs-target">ç›®æ¨™è¼‰å…¥ä¸­...</div>
                <button class="cs-btn-quit" onclick="quitChallenge()">
                    <i class="fas fa-sign-out-alt"></i> çµæŸæŒ‘æˆ°
                </button>
            </div>

            <!-- æƒ…å¢ƒæŒ‰éˆ• (éæŒ‘æˆ°æ™‚é¡¯ç¤º) -->
            <button id="btnOpenScenario" class="btn btn-scenario" onclick="toggleModal(true)">
                <i class="fas fa-book-open"></i> å¯¦é©—æƒ…å¢ƒ
            </button>

            <div class="section-title">ææ–™é¸æ“‡ <span style="font-size:0.7em; font-weight:normal;">(Î± = ç·šè†¨è„¹ä¿‚æ•¸)</span></div>
            <div class="control-group">
                <label>ä¸Šå±¤é‡‘å±¬ (Top)</label>
                <select id="matTop"></select>
            </div>
            <div class="control-group">
                <label>ä¸‹å±¤é‡‘å±¬ (Bottom)</label>
                <select id="matBottom"></select>
            </div>

            <div class="section-title">ç‰©ç†åƒæ•¸</div>
            <div class="control-group">
                <label>é•·åº¦ (Lâ‚€) <span id="valL" class="val-disp">200 mm</span></label>
                <input type="range" id="sliderL" min="100" max="300" value="200">
            </div>
            <div class="control-group">
                <label>è§¸é»é–“è· (Gap) <span id="valGap" class="val-disp">3.0 mm</span></label>
                <input type="range" id="sliderGap" min="0.5" max="10.0" step="0.1" value="3.0">
            </div>

            <div class="section-title">æº«åº¦æ§åˆ¶</div>
            <div class="control-group">
                <label>ç’°å¢ƒæº«åº¦ <span id="valTemp" class="val-disp">25Â°C</span></label>
                <input type="range" id="sliderTemp" min="25" max="200" value="25">
            </div>

            <button class="btn" id="btnAction" onclick="toggleHeating()">
                <i class="fas fa-play"></i> è‡ªå‹•åŠ ç†±æ¸¬è©¦
            </button>
            <button class="btn btn-reset" onclick="resetSim()">
                <i class="fas fa-undo"></i> é‡ç½®ç‹€æ…‹
            </button>
        </aside>

        <!-- å³å´å·¥ä½œå€ -->
        <main class="workspace">
            <div class="canvas-container" id="canvasContainer">
                <canvas id="simCanvas"></canvas>
                <div class="alarm-status">
                    <div id="alarmLight" class="alarm-light"></div>
                    <div class="alarm-label" id="alarmLabel">æœªè§¸ç™¼</div>
                </div>
                <!-- çµæœæç¤ºæ¡† -->
                <div id="resultToast" class="result-toast"></div>
            </div>

            <!-- æ•¸æ“šé¢æ¿ -->
            <div class="data-panel" id="dataPanel">
                <div style="grid-column: 1 / -1; border-bottom: 1px solid #334155; padding-bottom: 5px; color: #94a3b8; font-size:0.9rem;">
                    <i class="fas fa-calculator"></i> å¯¦é©—æ•¸æ“šç›£æ§
                </div>

                <!-- ä¸Šå±¤æ•¸æ“š -->
                <div class="formula-box">
                    <div style="color:var(--accent-color); margin-bottom:5px;">ä¸Šå±¤é‡‘å±¬ç‹€æ…‹</div>
                    <div class="math-row">Î± = <span class="math-val" id="dispAlphaTop">--</span> <span style="font-size:0.8em">10â»â¶/Â°C</span></div>
                    <div class="math-row">ä¼¸é•·é‡ Î”L = <span class="math-res" id="resDLTop">0.00</span> Î¼m</div>
                </div>

                <!-- ä¸‹å±¤æ•¸æ“š -->
                <div class="formula-box" style="border-left:1px solid #334155; padding-left:10px;">
                    <div style="color:var(--warning-color); margin-bottom:5px;">ä¸‹å±¤é‡‘å±¬ç‹€æ…‹</div>
                    <div class="math-row">Î± = <span class="math-val" id="dispAlphaBot">--</span> <span style="font-size:0.8em">10â»â¶/Â°C</span></div>
                    <div class="math-row">ä¼¸é•·é‡ Î”L = <span class="math-res" id="resDLBot">0.00</span> Î¼m</div>
                </div>
            </div>
        </main>
    </div>

    <!-- è©³ç´°æƒ…å¢ƒæ¨¡æ…‹è¦–çª— -->
    <div id="scenarioModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-tasks"></i> å¯¦é©—æƒ…å¢ƒ</h2>
                <button class="close-btn" onclick="toggleModal(false)">&times;</button>
            </div>
            <div class="modal-body">
                
                <!-- æƒ…å¢ƒ 1 -->
                <div class="scenario-card">
                    <span class="s-tag">æƒ…å¢ƒ Aï¼šå»šæˆ¿æ‡‰ç”¨ (é«˜éˆæ•åº¦)</span>
                    <div class="s-title">ç²¾æº–ç«ç½è­¦å ±ç³»çµ±</div>
                    <div class="s-desc">
                        å»šæˆ¿çš„æ²¹ç…™æº«åº¦è¼ƒé«˜ï¼Œæˆ‘å€‘éœ€è¦è¨­è¨ˆä¸€å€‹ä¸æœƒèª¤å ±çš„è­¦å ±å™¨ã€‚<br>
                        <strong>ç›®æ¨™ï¼š</strong>è®“è­¦å ±å™¨åœ¨ <strong>80Â°C Â± 2Â°C</strong> æ™‚æº–ç¢ºéŸ¿èµ·ã€‚40Â°C çš„å¤æ—¥å®¤æº«çµ•ä¸èƒ½è§¸ç™¼ã€‚
                    </div>
                    <div class="s-hint">
                        <i class="fas fa-lightbulb"></i>
                        <div>æç¤ºï¼šä½ éœ€è¦ã€Œæœ€å¤§éˆæ•åº¦ã€çš„ææ–™çµ„åˆï¼ˆå¦‚é»ƒéŠ…/æ®·é‹¼ï¼‰ï¼Œä¸¦ä»”ç´°å¾®èª¿ã€Œè§¸é»é–“è· (Gap)ã€ä¾†æ ¡æº–è§¸ç™¼é»ã€‚</div>
                    </div>
                    <button class="btn-start-challenge" onclick="startChallenge('A')">æ¥å—æŒ‘æˆ°</button>
                    <div style="clear:both;"></div>
                </div>

                <!-- æƒ…å¢ƒ 2 -->
                <div class="scenario-card" style="border-left-color: #4ade80;">
                    <span class="s-tag" style="color:#4ade80; background:rgba(74, 222, 128, 0.2);">æƒ…å¢ƒ Bï¼šè¾²æ¥­æ‡‰ç”¨ (æ¥µé«˜éˆæ•åº¦)</span>
                    <div class="s-title">æº«å®¤è‡ªå‹•é–‹çª—å™¨</div>
                    <div class="s-desc">
                        æ¤ç‰©å°æº«åº¦å¾ˆæ•æ„Ÿã€‚ç•¶æº«åº¦å¾ 25Â°C ä¸Šå‡åˆ° <strong>35Â°C</strong> (å¾®å°æº«å·®) æ™‚ï¼Œè£ç½®å°±è¦å‹•ä½œæ¨é–‹æ°£çª—ã€‚
                    </div>
                    <div class="s-hint" style="color:#4ade80; background:rgba(74, 222, 128, 0.1);">
                        <i class="fas fa-lightbulb"></i>
                        <div>æç¤ºï¼šæº«å·®å¾ˆå°ï¼Œæ„å‘³è‘— &Delta;T å¾ˆå°ã€‚ç‚ºäº†ç²å¾—è¶³å¤ çš„å½æ›²é‡ï¼Œä½ éœ€è¦å°‡ã€Œé‡‘å±¬ç‰‡é•·åº¦ (Lâ‚€)ã€æ‹‰åˆ°æœ€å¤§ã€‚</div>
                    </div>
                    <button class="btn-start-challenge" style="background:#4ade80; color:#064e3b;" onclick="startChallenge('B')">æ¥å—æŒ‘æˆ°</button>
                    <div style="clear:both;"></div>
                </div>

                <!-- æƒ…å¢ƒ 3 -->
                <div class="scenario-card" style="border-left-color: #ef4444;">
                    <span class="s-tag" style="color:#ef4444; background:rgba(239, 68, 68, 0.2);">æƒ…å¢ƒ Cï¼šå·¥æ¥­å®‰å…¨ (ä½éˆæ•åº¦)</span>
                    <div class="s-title">é«˜æº«éè¼‰æ–·è·¯å™¨</div>
                    <div class="s-desc">
                        é€™æ˜¯ä¸€å€‹åå‘è¨­è¨ˆã€‚å·¥æ¥­é¦¬é”å…è¨±å·¥ä½œåˆ° 100Â°Cï¼Œåªæœ‰åœ¨ <strong>120Â°C</strong> æ¥µé«˜æº«æ™‚æ‰éœ€è¦åˆ‡æ–·é›»è·¯ï¼ˆåœ¨æ­¤æ¨¡æ“¬ä¸­è¦–ç‚ºè§¸ç™¼ï¼‰ã€‚
                    </div>
                    <div class="s-hint" style="color:#ef4444; background:rgba(239, 68, 68, 0.1);">
                        <i class="fas fa-lightbulb"></i>
                        <div>æç¤ºï¼šä½ éœ€è¦ä¸€å€‹ã€Œé²éˆã€çš„è£ç½®ã€‚è©¦è‘—ä½¿ç”¨è†¨è„¹ä¿‚æ•¸å·®ç•°æ¥µå°çš„çµ„åˆï¼ˆä¾‹å¦‚é»ƒéŠ…/ç´…éŠ…ï¼‰ï¼Œé¿å…å¤ªæ—©è§¸ç™¼ã€‚</div>
                    </div>
                    <button class="btn-start-challenge" style="background:#ef4444; color:#fff;" onclick="startChallenge('C')">æ¥å—æŒ‘æˆ°</button>
                    <div style="clear:both;"></div>
                </div>

                <!-- æ–°å¢ï¼šç‰©ç†æ¨¡å‹å‡è¨­å€å¡Š -->
                <div class="assumptions-box">
                    <h3><i class="fas fa-cube"></i> ç‰©ç†æ¨¡å‹å‡è¨­ (Physical Assumptions)</h3>
                    <p>é€™å€‹æ¨¡æ“¬å™¨å»ºç«‹åœ¨ç†æƒ³åŒ–çš„ç‰©ç†ç’°å¢ƒä¸­ï¼Œå¿½ç•¥äº†éƒ¨åˆ†ç¾å¯¦ä¸–ç•Œçš„å¹²æ“¾å› ç´ ï¼š</p>
                    <ul>
                        <li><strong>å‡å‹»å—ç†± (Uniform Heating)ï¼š</strong>å‡è¨­é‡‘å±¬ç‰‡å¾é ­åˆ°å°¾çš„æº«åº¦æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚å¿½ç•¥äº†ç†±å‚³å°éœ€è¦æ™‚é–“ï¼Œèª¿æ•´æº«åº¦æ»‘æ¡¿æ™‚ï¼Œæ•´æ ¹é‡‘å±¬ç‰‡æœƒç¬é–“é”åˆ°è©²æº«åº¦ã€‚</li>
                        <li><strong>ç†æƒ³é»åˆ (Perfect Bonding)ï¼š</strong>å‡è¨­ä¸Šä¸‹å…©å±¤é‡‘å±¬ç·Šå¯†é»åˆï¼Œä¸­é–“æ²’æœ‰æ»‘å‹•ï¼Œä¸”é»è‘—åŠ‘ä¸æœƒå› ç‚ºé«˜æº«è€Œå¤±æ•ˆã€‚é€™è¿«ä½¿å…©å±¤é‡‘å±¬å› ç‚ºé•·åº¦è®ŠåŒ–ä¸ä¸€è‡´è€Œå¿…é ˆå½æ›²ã€‚</li>
                        <li><strong>ç·šæ€§è†¨è„¹ (Linear Expansion)ï¼š</strong>ä½¿ç”¨å…¬å¼ &Delta;L = L<sub>0</sub> &times; &alpha; &times; &Delta;Tã€‚å‡è¨­åœ¨ 25&deg;C ~ 200&deg;C çš„ç¯„åœå…§ï¼Œè†¨è„¹ä¿‚æ•¸ &alpha; æ˜¯å¸¸æ•¸ï¼ˆå¯¦éš›ä¸Šé«˜æº«ä¸‹ä¿‚æ•¸å¯èƒ½æœƒå¾®å¹…æ”¹è®Šï¼Œä½†åœ¨ä¸€èˆ¬ç‰©ç†å¯¦é©—ä¸­é€šå¸¸è¦–ç‚ºå®šå€¼ï¼‰ã€‚</li>
                        <li><strong>å¿½ç•¥é‡åŠ›èˆ‡é˜»åŠ› (Ignore Gravity & Friction)ï¼š</strong>é‡‘å±¬ç‰‡ä¸å—é‡åŠ›ä¸‹å‚å½±éŸ¿ï¼Œä¹Ÿä¸å—ç©ºæ°£é˜»åŠ›å½±éŸ¿ï¼Œå½æ›²å®Œå…¨ä¾†è‡ªæ–¼ç†±æ‡‰åŠ›ã€‚</li>
                    </ul>
                </div>

                <button class="btn" style="margin-top: 20px;" onclick="toggleModal(false)">é–‹å§‹å¯¦é©—</button>
            </div>
        </div>
    </div>

    <script>
        // --- è³‡æ–™åº« ---
        // alpha: ç·šè†¨è„¹ä¿‚æ•¸ (10^-6/C)
        // c: æ¯”ç†± (J/gÂ·C)
        // rho: å¯†åº¦ (g/cm^3)
        const MATERIALS = [
            { name: 'é‹ (Aluminum)', alpha: 23.1, c: 0.90, rho: 2.7, color: '#e2e8f0' },
            { name: 'é»ƒéŠ… (Brass)', alpha: 19.0, c: 0.38, rho: 8.5, color: '#facc15' },
            { name: 'ç´…éŠ… (Copper)', alpha: 17.0, c: 0.39, rho: 8.96, color: '#f87171' },
            { name: 'éµ (Iron)', alpha: 11.8, c: 0.45, rho: 7.87, color: '#94a3b8' },
            { name: 'ç™½é‡‘ (Platinum)', alpha: 8.8, c: 0.13, rho: 21.45, color: '#cbd5e1' },
            { name: 'æ®·é‹¼ (Invar)', alpha: 1.2, c: 0.50, rho: 8.1, color: '#475569' }
        ];

        // --- æŒ‘æˆ°è¨­å®š ---
        const CHALLENGES = {
            'A': { title: 'æƒ…å¢ƒ Aï¼šç«ç½è­¦å ±', targetMin: 78, targetMax: 82, desc: 'ç›®æ¨™ï¼š80Â°C Â± 2Â°C è§¸ç™¼ (é«˜éˆæ•åº¦)', type: 'high_sens' },
            'B': { title: 'æƒ…å¢ƒ Bï¼šæº«å®¤é–‹çª—', targetMin: 34, targetMax: 36, desc: 'ç›®æ¨™ï¼š35Â°C Â± 1Â°C è§¸ç™¼ (æ¥µé«˜éˆæ•åº¦)', type: 'max_sens' },
            'C': { title: 'æƒ…å¢ƒ Cï¼šéè¼‰æ–·è·¯', targetMin: 115, targetMax: 125, desc: 'ç›®æ¨™ï¼š120Â°C Â± 5Â°C è§¸ç™¼ (ä½éˆæ•åº¦)', type: 'low_sens' }
        };

        // --- æ‡‰ç”¨ç¨‹å¼ç‹€æ…‹ ---
        const appState = {
            matTop: 1,   // Brass
            matBot: 5,   // Invar
            length: 200,
            gap: 3.0,
            temp: 25,
            heating: false,
            alarm: false,
            activeChallenge: null, // 'A', 'B', 'C' or null
            challengeCompleted: false
        };

        const config = {
            originX: 60,
            originY: 0, // åœ¨ resize æ™‚è¨ˆç®—
            stripThick: 12,
            pxPerMm: 1.5
        };

        // --- å…¨åŸŸè®Šæ•¸ (å»¶é²åˆå§‹åŒ–) ---
        let dom = {};
        let ctx;

        // --- åˆå§‹åŒ– ---
        function init() {
            cacheDOM();
            
            if(dom.canvas) {
                ctx = dom.canvas.getContext('2d');
            } else {
                console.error("æ‰¾ä¸åˆ° Canvas å…ƒç´ ");
                return;
            }

            populateMaterials();
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            // ç¶å®šè¼¸å…¥äº‹ä»¶
            dom.matTop.addEventListener('change', (e) => { appState.matTop = +e.target.value; updatePhysics(); });
            dom.matBot.addEventListener('change', (e) => { appState.matBot = +e.target.value; updatePhysics(); });
            
            dom.sliderL.addEventListener('input', (e) => { appState.length = +e.target.value; dom.valL.innerText = appState.length + ' mm'; });
            dom.sliderGap.addEventListener('input', (e) => { appState.gap = +e.target.value; dom.valGap.innerText = appState.gap.toFixed(1) + ' mm'; });
            
            dom.sliderTemp.addEventListener('input', (e) => {
                appState.temp = +e.target.value;
                dom.valTemp.innerText = appState.temp + 'Â°C';
                // æ‰‹å‹•æ‹‰å‹•æ™‚æš«åœè‡ªå‹•åŠ ç†±
                appState.heating = false;
                dom.btnAction.innerHTML = '<i class="fas fa-play"></i> è‡ªå‹•åŠ ç†±æ¸¬è©¦';
            });

            animate();
        }

        function cacheDOM() {
            dom = {
                matTop: document.getElementById('matTop'),
                matBot: document.getElementById('matBottom'),
                sliderL: document.getElementById('sliderL'),
                valL: document.getElementById('valL'),
                sliderGap: document.getElementById('sliderGap'),
                valGap: document.getElementById('valGap'),
                sliderTemp: document.getElementById('sliderTemp'),
                valTemp: document.getElementById('valTemp'),
                btnAction: document.getElementById('btnAction'),
                canvas: document.getElementById('simCanvas'),
                alarmLight: document.getElementById('alarmLight'),
                modal: document.getElementById('scenarioModal'),
                dispAlphaTop: document.getElementById('dispAlphaTop'),
                resDLTop: document.getElementById('resDLTop'),
                dispAlphaBot: document.getElementById('dispAlphaBot'),
                resDLBot: document.getElementById('resDLBot'),
                // Challenge UI
                btnOpenScenario: document.getElementById('btnOpenScenario'),
                challengeStatus: document.getElementById('challengeStatus'),
                csTargetText: document.getElementById('csTargetText'),
                resultToast: document.getElementById('resultToast'),
                alarmLabel: document.getElementById('alarmLabel')
            };
        }

        function populateMaterials() {
            const createOption = (m, i) => {
                const opt = document.createElement('option');
                opt.value = i;
                // é¡¯ç¤ºææ–™åç¨±èˆ‡è†¨è„¹ä¿‚æ•¸
                opt.text = `${m.name} [Î±=${m.alpha}]`; 
                return opt;
            };
            
            if (!dom.matTop || !dom.matBot) return;

            dom.matTop.innerHTML = '';
            dom.matBot.innerHTML = '';
            
            MATERIALS.forEach((m, i) => {
                dom.matTop.appendChild(createOption(m, i));
                dom.matBot.appendChild(createOption(m, i));
            });
            
            dom.matTop.value = appState.matTop;
            dom.matBot.value = appState.matBot;
        }

        // --- æ¨¡æ…‹è¦–çª—æ§åˆ¶ ---
        function toggleModal(show) {
            if (dom.modal) dom.modal.style.display = show ? 'flex' : 'none';
        }

        // --- æŒ‘æˆ°é‚è¼¯ ---
        function startChallenge(id) {
            appState.activeChallenge = id;
            appState.challengeCompleted = false;
            
            // é‡ç½®ä¸¦è¨­å®šåˆå§‹ç‹€æ…‹
            resetSim();
            toggleModal(false);
            
            // UI æ›´æ–°
            dom.challengeStatus.style.display = 'block';
            dom.btnOpenScenario.style.display = 'none';
            dom.csTargetText.innerText = CHALLENGES[id].desc;
            dom.alarmLabel.innerText = "åµæ¸¬ä¸­...";
        }

        function quitChallenge() {
            appState.activeChallenge = null;
            appState.challengeCompleted = false;
            
            dom.challengeStatus.style.display = 'none';
            dom.btnOpenScenario.style.display = 'flex';
            dom.alarmLabel.innerText = "è§¸ç™¼é» ~80Â°C"; // å›å¾©é è¨­
            hideToast();
        }

        function checkChallengeSuccess(triggerTemp) {
            if (!appState.activeChallenge || appState.challengeCompleted) return;
            
            const config = CHALLENGES[appState.activeChallenge];
            const mTop = MATERIALS[appState.matTop];
            const mBot = MATERIALS[appState.matBot];
            const deltaAlpha = Math.abs(mTop.alpha - mBot.alpha);

            appState.challengeCompleted = true; // é˜²æ­¢é‡è¤‡è§¸ç™¼
            appState.heating = false; // æš«åœåŠ ç†±
            dom.btnAction.innerHTML = '<i class="fas fa-play"></i> é‡æ–°æ¸¬è©¦';

            // 1. æª¢æŸ¥æº«åº¦æ˜¯å¦é”æ¨™
            const tempOk = (triggerTemp >= config.targetMin && triggerTemp <= config.targetMax);
            
            // 2. æª¢æŸ¥ææ–™é¸æ“‡ (æƒ…å¢ƒç‰¹æœ‰çš„ç‰©ç†é™åˆ¶)
            let materialOk = true;
            let failReason = "";

            if (config.type === 'high_sens' || config.type === 'max_sens') {
                // é«˜éˆæ•åº¦æƒ…å¢ƒï¼šå¿…é ˆé¸è†¨è„¹ä¿‚æ•¸å·®ç•°å¤§çš„ææ–™ (ä¾‹å¦‚å·®å€¼ > 10)
                if (deltaAlpha < 10) {
                    materialOk = false;
                    failReason = "ææ–™è†¨è„¹ä¿‚æ•¸å·®ç•°å¤ªå°ï¼Œéˆæ•åº¦ä¸è¶³ï¼è«‹é¸æ“‡å·®ç•°æ›´å¤§çš„çµ„åˆï¼ˆå¦‚é»ƒéŠ…/æ®·é‹¼ï¼‰ã€‚";
                }
            } else if (config.type === 'low_sens') {
                // ä½éˆæ•åº¦æƒ…å¢ƒ
                // é€™è£¡æˆ‘å€‘æ”¾å¯¬ä¸€é»ï¼Œä¸»è¦çœ‹æ˜¯å¦èƒ½é”åˆ°é«˜æº«
                // å¦‚æœå¤ªæ—©è§¸ç™¼é€šå¸¸æ˜¯ææ–™é¸éŒ¯
                if (triggerTemp < 100) {
                    // å¦‚æœè§¸ç™¼æº«åº¦å¤ªä½ï¼Œæç¤ºæ›´æ›ææ–™
                    // ä½†é€™è£¡ä¸»è¦ç”± tempOk åˆ¤æ–·ï¼Œè‹¥ tempOk ç‚º falseï¼Œä¸‹é¢æœƒè™•ç†
                }
            }

            if (tempOk && materialOk) {
                showToast(true, `ğŸ‰ æŒ‘æˆ°æˆåŠŸï¼è§¸ç™¼æº«åº¦ ${triggerTemp.toFixed(1)}Â°C`);
            } else if (!tempOk) {
                let reason = triggerTemp < config.targetMin ? "å¤ªæ—©è§¸ç™¼" : "å¤ªæ™šè§¸ç™¼";
                // é‡å°æƒ…å¢ƒ C çš„ç‰¹æ®Šæç¤º
                if (config.type === 'low_sens' && triggerTemp < config.targetMin) {
                    reason += "ã€‚æç¤ºï¼šæ­¤ææ–™çµ„åˆåæ‡‰å¤ªå¿«ï¼Œè«‹é¸ç”¨è¼ƒé²éˆçš„çµ„åˆï¼ˆå¦‚é»ƒéŠ…/ç´…éŠ…ï¼‰ã€‚";
                }
                showToast(false, `âŒ å¤±æ•—ï¼${reason} (è§¸ç™¼: ${triggerTemp.toFixed(1)}Â°C)`);
            } else if (!materialOk) {
                showToast(false, `âŒ å¤±æ•—ï¼${failReason}`);
            }
        }

        function showToast(success, msg) {
            dom.resultToast.innerText = msg;
            dom.resultToast.className = 'result-toast ' + (success ? 'toast-success' : 'toast-fail');
            dom.resultToast.style.display = 'block';
            
            // 5ç§’å¾Œè‡ªå‹•æ¶ˆå¤±
            setTimeout(() => {
                dom.resultToast.style.display = 'none';
            }, 5000);
        }

        function hideToast() {
            dom.resultToast.style.display = 'none';
        }

        // --- ç‰©ç†èˆ‡æ§åˆ¶ ---
        function toggleHeating() {
            appState.heating = !appState.heating;
            if (appState.heating) {
                dom.btnAction.innerHTML = '<i class="fas fa-pause"></i> æš«åœæ¸¬è©¦';
                if (appState.temp >= 200) appState.temp = 25; // é‡ç½®
                
                // æŒ‘æˆ°é–‹å§‹æ–°çš„ä¸€è¼ª
                if (appState.activeChallenge) {
                    appState.challengeCompleted = false;
                    hideToast();
                }
            } else {
                dom.btnAction.innerHTML = '<i class="fas fa-play"></i> ç¹¼çºŒæ¸¬è©¦';
            }
        }

        function resetSim() {
            appState.heating = false;
            appState.temp = 25;
            appState.alarm = false;
            dom.valTemp.innerText = '25Â°C';
            dom.sliderTemp.value = 25;
            dom.btnAction.innerHTML = '<i class="fas fa-play"></i> è‡ªå‹•åŠ ç†±æ¸¬è©¦';
            dom.alarmLight.classList.remove('alarm-on');
            hideToast();
        }

        function updatePhysics() {
            const mTop = MATERIALS[appState.matTop];
            const mBot = MATERIALS[appState.matBot];
            
            // æ›´æ–° UI é¡¯ç¤ºçš„æ•¸å€¼ (é è¨­é¡¯ç¤º)
            if(dom.dispAlphaTop) dom.dispAlphaTop.innerText = mTop.alpha;
            if(dom.dispAlphaBot) dom.dispAlphaBot.innerText = mBot.alpha;
        }

        function animate() {
            // 1. ç‰©ç†æ›´æ–° Loop
            if (appState.heating) {
                let step = 0.5; // å‡æº«é€Ÿåº¦
                
                if (appState.temp < 200) {
                    appState.temp += step;
                    dom.sliderTemp.value = appState.temp;
                    dom.valTemp.innerText = Math.floor(appState.temp) + 'Â°C';
                } else {
                    appState.heating = false;
                    dom.btnAction.innerHTML = '<i class="fas fa-undo"></i> æ¸¬è©¦çµæŸ (é‡ç½®)';
                }
            }

            // 2. æ•¸æ“šæ›´æ–°
            const dT = appState.temp - 25;
            const mTop = MATERIALS[appState.matTop];
            const mBot = MATERIALS[appState.matBot];
            
            // é¡¯ç¤ºå¾®ç±³ä¼¸é•·é‡
            const dlTop = appState.length * (mTop.alpha * 1e-6) * dT * 1000;
            const dlBot = appState.length * (mBot.alpha * 1e-6) * dT * 1000;
            
            if(dom.dispAlphaTop) dom.dispAlphaTop.innerText = mTop.alpha;
            if(dom.dispAlphaBot) dom.dispAlphaBot.innerText = mBot.alpha;
            if(dom.resDLTop) dom.resDLTop.innerText = dlTop.toFixed(2);
            if(dom.resDLBot) dom.resDLBot.innerText = dlBot.toFixed(2);

            // 3. ç¹ªåœ–
            draw(mTop, mBot, dT);
            
            requestAnimationFrame(animate);
        }

        function draw(mTop, mBot, dT) {
            ctx.clearRect(0, 0, dom.canvas.width, dom.canvas.height);
            
            const startX = config.originX;
            const startY = dom.canvas.height / 2;
            
            // ç‰©ç†å½æ›²æ¨¡æ“¬ (è¦–è¦ºæ”¾å¤§)
            const dAlpha = (mTop.alpha - mBot.alpha) * 1e-6;
            const bendFactor = 0.8; // å¤§å¹…å¢åŠ ä¿‚æ•¸ä»¥é…åˆçœŸå¯¦ç‰©ç†å–®ä½çš„å¾®å°æ•¸å€¼
            const deflection = appState.length * appState.length * dAlpha * dT * bendFactor;
            
            // ç¹ªè£½ç‰†å£
            ctx.fillStyle = '#334155';
            ctx.fillRect(0, 0, startX, dom.canvas.height);
            
            // ç¹ªè£½é‡‘å±¬ç‰‡ (ä½¿ç”¨è²èŒ²æ›²ç·š)
            const endX = startX + appState.length * config.pxPerMm;
            const endY = startY + deflection;
            const cpX = (startX + endX) / 2;
            const cpY = startY + deflection / 2;

            drawStripPart(mTop.color, startX, startY - config.stripThick, cpX, cpY - config.stripThick, endX, endY - config.stripThick);
            drawStripPart(mBot.color, startX, startY, cpX, cpY, endX, endY);
            
            // ç¹ªè£½è§¸é»
            const gapPx = appState.gap * 10;
            const contactX = endX;
            const contactY = startY + gapPx + config.stripThick;
            
            ctx.fillStyle = '#475569';
            ctx.fillRect(contactX - 10, contactY, 20, 60);
            ctx.beginPath();
            ctx.arc(contactX, contactY, 5, 0, Math.PI*2);
            
            // æ¥è§¸åˆ¤å®š
            // æ¢ä»¶ï¼šå‘ä¸‹å½ (>0) ä¸” è¶…é Gap
            const currentTipY = endY + config.stripThick;
            const isTouching = (deflection > 0) && (currentTipY >= contactY);
            
            if (isTouching) {
                ctx.fillStyle = '#ef4444';
                ctx.fill();
                if (!appState.alarm) {
                    // è­¦å ±è§¸ç™¼ç¬é–“ (Rising Edge)
                    appState.alarm = true;
                    dom.alarmLight.classList.add('alarm-on');
                    playBeep();
                    
                    // æª¢æŸ¥æŒ‘æˆ°æ˜¯å¦æˆåŠŸ
                    if (appState.activeChallenge) {
                        checkChallengeSuccess(appState.temp);
                    }
                }
            } else {
                ctx.fillStyle = '#94a3b8';
                ctx.fill();
                appState.alarm = false;
                dom.alarmLight.classList.remove('alarm-on');
            }

            // ç¹ªè£½ç«ç„° (æ‰‹å‹•æˆ–è‡ªå‹•é«˜æº«æ™‚)
            if (appState.heating || appState.temp > 40) {
                drawFlame(startX + (appState.length * config.pxPerMm)/2, startY + 80);
            }
        }

        function drawStripPart(color, x0, y0, cpx, cpy, x1, y1) {
            ctx.beginPath();
            ctx.moveTo(x0, y0);
            ctx.quadraticCurveTo(cpx, cpy, x1, y1);
            ctx.lineTo(x1, y1 + config.stripThick);
            ctx.quadraticCurveTo(cpx, cpy + config.stripThick, x0, y0 + config.stripThick);
            ctx.fillStyle = color;
            ctx.fill();
            ctx.strokeStyle = 'rgba(0,0,0,0.2)';
            ctx.stroke();
        }

        let flameT = 0;
        function drawFlame(x, y) {
            flameT += 0.2;
            const scale = (appState.temp - 25) / 100;
            if (scale <= 0) return;
            
            ctx.save();
            ctx.translate(x, y);
            ctx.scale(scale, scale);
            ctx.beginPath();
            ctx.moveTo(-15, 0);
            ctx.quadraticCurveTo(0, -60 - Math.sin(flameT)*5, 15, 0);
            ctx.fillStyle = 'rgba(255, 100, 0, 0.6)';
            ctx.fill();
            ctx.restore();
        }

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playBeep() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            osc.connect(g);
            g.connect(audioCtx.destination);
            osc.frequency.value = 880;
            g.gain.value = 0.1;
            osc.start();
            osc.stop(audioCtx.currentTime + 0.1);
        }

        function resizeCanvas() {
            const wrap = document.getElementById('canvasContainer');
            dom.canvas.width = wrap.clientWidth;
            dom.canvas.height = wrap.clientHeight;
        }

        // --- å•Ÿå‹• (ç¢ºä¿ DOM è¼‰å…¥å¾ŒåŸ·è¡Œ) ---
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }

    </script>
</body>
</html>